From 842b8f7ae6d2239a9b53d85bbd8b1b52a578a1bf Mon Sep 17 00:00:00 2001
From: roidy <roidy.parnell@ntlworld.com>
Date: Sat, 13 Apr 2019 21:35:22 +0100
Subject: [PATCH] Display amlogic hdmitx info in Estuary skins PlayerProcess
 window.

---
 .../resource.language.en_gb/strings.po        | 30 +++++++
 .../xml/DialogPlayerProcessInfo.xml           | 89 ++++++++++++++++---
 2 files changed, 107 insertions(+), 12 deletions(-)

diff --git a/addons/skin.estuary/language/resource.language.en_gb/strings.po b/addons/skin.estuary/language/resource.language.en_gb/strings.po
index 6b152c14dc3..6de25826c53 100644
--- a/addons/skin.estuary/language/resource.language.en_gb/strings.po
+++ b/addons/skin.estuary/language/resource.language.en_gb/strings.po
@@ -792,3 +792,33 @@ msgstr ""
 msgctxt "#31169"
 msgid "Artwork related settings."
 msgstr ""
+
+#: /xml/DialogPlayerProcessInfo.xml
+msgctxt "#32100"
+msgid "Display mode"
+msgstr ""
+
+#: /xml/DialogPlayerProcessInfo.xml
+msgctxt "#32101"
+msgid "Colour depth"
+msgstr ""
+
+#: /xml/DialogPlayerProcessInfo.xml
+msgctxt "#32102"
+msgid "Colour space"
+msgstr ""
+
+#: /xml/DialogPlayerProcessInfo.xml
+msgctxt "#32103"
+msgid "Colour range"
+msgstr ""
+
+#: /xml/DialogPlayerProcessInfo.xml
+msgctxt "#32104"
+msgid "EOTF"
+msgstr ""
+
+#: /xml/DialogPlayerProcessInfo.xml
+msgctxt "#32105"
+msgid "Colourimetry"
+msgstr ""
diff --git a/addons/skin.estuary/xml/DialogPlayerProcessInfo.xml b/addons/skin.estuary/xml/DialogPlayerProcessInfo.xml
index 46c61f46d88..9b3fc66e9bb 100644
--- a/addons/skin.estuary/xml/DialogPlayerProcessInfo.xml
+++ b/addons/skin.estuary/xml/DialogPlayerProcessInfo.xml
@@ -1,5 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <window>
+	<onload>RunScript(script.amlogic.displayinfo)</onload>
 	<depth>DepthOSD</depth>
 	<defaultcontrol always="true">5550</defaultcontrol>
 	<animation effect="fade" start="0" end="100" time="300">WindowOpen</animation>
@@ -7,13 +8,13 @@
 	<controls>
 		<control type="group">
 			<bottom>0</bottom>
-			<height>250</height>
+			<height>300</height>
 			<animation effect="slide" end="0,-20" time="150" condition="VideoPlayer.Content(LiveTV)">conditional</animation>
 			<control type="image">
 				<left>30</left>
 				<top>-220</top>
 				<right>30</right>
-				<height>330</height>
+				<height>420</height>
 				<texture border="40">dialogs/dialog-bg-nobo.png</texture>
 			</control>
 			<control type="grouplist">
@@ -133,7 +134,7 @@
 				<top>-204</top>
 				<visible>Control.HasFocus(5552)</visible>
 				<control type="label">
-					<width>1600</width>
+					<width>1200</width>
 					<height>50</height>
 					<aligny>bottom</aligny>
 					<label>$INFO[Player.Process(videodecoder),[COLOR button_focus]$LOCALIZE[31139]:[/COLOR] ]$VAR[VideoHWDecoder, (,)]</label>
@@ -142,7 +143,7 @@
 					<visible>Player.HasVideo</visible>
 				</control>
 				<control type="label">
-					<width>1600</width>
+					<width>1200</width>
 					<height>50</height>
 					<aligny>bottom</aligny>
 					<label>$INFO[Player.Process(pixformat),[COLOR button_focus]$LOCALIZE[31140]:[/COLOR] ]</label>
@@ -151,7 +152,7 @@
 					<visible>Player.HasVideo</visible>
 				</control>
 				<control type="label">
-					<width>1600</width>
+					<width>1200</width>
 					<height>50</height>
 					<aligny>bottom</aligny>
 					<label>$INFO[Player.Process(deintmethod),[COLOR button_focus]$LOCALIZE[16038]:[/COLOR] ]</label>
@@ -160,7 +161,7 @@
 					<visible>Player.HasVideo</visible>
 				</control>
 				<control type="label">
-					<width>1600</width>
+					<width>1200</width>
 					<height>50</height>
 					<aligny>bottom</aligny>
 					<label>$INFO[Player.Process(videowidth),[COLOR button_focus]$LOCALIZE[38031]:[/COLOR] ,x]$INFO[Player.Process(videoheight),,]$INFO[Player.Process(videointerlace),,]$INFO[Player.Process(videodar),$COMMA , AR]$INFO[Player.Process(videofps),$COMMA , FPS]$INFO[VideoPlayer.VideoBitrate,$COMMA , kb/s]</label>
@@ -169,7 +170,7 @@
 					<visible>Player.HasVideo</visible>
 				</control>
 				<control type="label">
-					<width>1600</width>
+					<width>1200</width>
 					<height>50</height>
 					<aligny>bottom</aligny>
 					<label>[COLOR button_focus]$LOCALIZE[460]:[/COLOR] $INFO[Player.Process(audiochannels),,$COMMA ]$INFO[Player.Process(audiodecoder)]$INFO[Player.Process(audiobitspersample),$COMMA , bits]$INFO[Player.Process(audiosamplerate),$COMMA , Hz]$INFO[VideoPlayer.AudioBitrate,$COMMA , kb/s]</label>
@@ -177,24 +178,88 @@
 					<shadowcolor>black</shadowcolor>
 				</control>
 				<control type="label">
-					<width>1600</width>
+					<width>1200</width>
 					<height>50</height>
 					<aligny>bottom</aligny>
-					<label>$INFO[System.Memory(used.percent),[COLOR button_focus]$LOCALIZE[31030]:[/COLOR] ,       ]$INFO[System.CpuUsage,[COLOR button_focus]$LOCALIZE[13271][/COLOR] ]</label>
+					<label>[COLOR button_focus]$LOCALIZE[31030]:[/COLOR] $INFO[system.memory(used)] / $INFO[system.memory(total)] - $INFO[system.memory(used.percent)]</label>
 					<font>font14</font>
 					<shadowcolor>black</shadowcolor>
-					<visible>System.SupportsCPUUsage</visible>
 				</control>
 				<control type="label">
 					<width>1600</width>
 					<height>50</height>
 					<aligny>bottom</aligny>
-					<label>$INFO[System.Memory(used.percent),[COLOR button_focus]$LOCALIZE[31030]:[/COLOR] ]</label>
+					<label>$INFO[System.CpuUsage,[COLOR button_focus]$LOCALIZE[13271][/COLOR] ]</label>
 					<font>font14</font>
 					<shadowcolor>black</shadowcolor>
-					<visible>!System.SupportsCPUUsage</visible>
 				</control>
 			</control>
+			<control type="grouplist">
+				<left>1250</left>
+				<top>-204</top>
+				<visible>Control.HasFocus(5552)</visible>
+
+				<control type="label">
+					<width>600</width>
+					<height>50</height>
+					<aligny>bottom</aligny>
+					<label>$INFO[Window(10000).Property(amlogic.hdmitx.displaymode),[COLOR button_focus]$LOCALIZE[32100]:[/COLOR] ]</label>
+					<font>font14</font>
+					<shadowcolor>black</shadowcolor>
+					<visible>Player.HasVideo</visible>
+				</control>
+
+				<control type="label">
+					<width>600</width>
+					<height>50</height>
+					<aligny>bottom</aligny>
+					<label>$INFO[Window(10000).Property(amlogic.hdmitx.colourdepth),[COLOR button_focus]$LOCALIZE[32101]:[/COLOR] ]</label>
+					<font>font14</font>
+					<shadowcolor>black</shadowcolor>
+					<visible>Player.HasVideo</visible>
+				</control>
+
+				<control type="label">
+					<width>600</width>
+					<height>50</height>
+					<aligny>bottom</aligny>
+					<label>$INFO[Window(10000).Property(amlogic.hdmitx.colourspace),[COLOR button_focus]$LOCALIZE[32102]:[/COLOR] ]</label>
+					<font>font14</font>
+					<shadowcolor>black</shadowcolor>
+					<visible>Player.HasVideo</visible>
+				</control>
+
+				<control type="label">
+					<width>600</width>
+					<height>50</height>
+					<aligny>bottom</aligny>
+					<label>$INFO[Window(10000).Property(amlogic.hdmitx.colourrange),[COLOR button_focus]$LOCALIZE[32103]:[/COLOR] ]</label>
+					<font>font14</font>
+					<shadowcolor>black</shadowcolor>
+					<visible>Player.HasVideo</visible>
+				</control>
+
+				<control type="label">
+					<width>600</width>
+					<height>50</height>
+					<aligny>bottom</aligny>
+					<label>$INFO[Window(10000).Property(amlogic.hdmitx.eotf),[COLOR button_focus]$LOCALIZE[32104]:[/COLOR] ]</label>
+					<font>font14</font>
+					<shadowcolor>black</shadowcolor>
+					<visible>Player.HasVideo</visible>
+				</control>
+
+				<control type="label">
+					<width>600</width>
+					<height>50</height>
+					<aligny>bottom</aligny>
+					<label>$INFO[Window(10000).Property(amlogic.hdmitx.colourimetry),[COLOR button_focus]$LOCALIZE[32105]:[/COLOR] ]</label>
+					<font>font14</font>
+					<shadowcolor>black</shadowcolor>
+					<visible>Player.HasVideo</visible>
+				</control>
+			</control>
+
 			<control type="grouplist" id="5550">
 				<right>15</right>
 				<top>-310</top>
